package com.ist.DepChain.besu;

import com.google.gson.JsonArray;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Base64;

import java.security.*;
import java.io.FileInputStream;
import java.io.FileOutputStream;

public class CreateGenesisBlock {

    public static void main(String[] args) {
        // Create the genesis block JSON object
        JsonObject genesisBlock = new JsonObject();

        // Add block hash (simulating the first block, can be updated later)
        genesisBlock.addProperty("block_hash", "<HASH_OF_LIST_OF_TRANSACTIONS>");
        genesisBlock.addProperty("previous_block_hash", "null"); // First block, no previous block

        // Create the transactions array (empty for now)
        JsonArray transactions = new JsonArray();
        genesisBlock.add("transactions", transactions);

        // Create the state object which contains accounts and contract details
        JsonObject state = new JsonObject();

        // Add an Externally Owned Account (EOA) with an initial balance
        JsonObject ownerAccount = new JsonObject();
        ownerAccount.addProperty("balance", "100000"); // balance in the smallest unit (e.g., wei for Ether)
        ownerAccount.addProperty("address", "0000000000000000000000000000000000000001");
        String encodedPubKey = "";
        try{
            encodedPubKey = generateRSAKeys("Owner");
            ownerAccount.addProperty("Public Key", encodedPubKey);
        } catch (Exception e) {
            System.out.println("Error generating keys for Owner: " + e.getMessage());
        }
        state.add("Owner Account", ownerAccount);


        for(int i=0; i<3; i++){
            JsonObject clientAccount = new JsonObject();
            clientAccount.addProperty("balance", "100000");
            clientAccount.addProperty("address", "000000000000000000000000000000000000000"+(i+2));
            try{
                encodedPubKey = generateRSAKeys("Client_"+(i+1));
            }
            catch (Exception e){
                System.out.println("Error generating keys for Client "+(i+1)+": "+e.getMessage());
            }
            clientAccount.addProperty("Public Key", encodedPubKey);
            state.add("Client Account "+(i+1), clientAccount);
        }

        // Add the ISTCoin contract account (ERC20)
        JsonObject istCoinContract = new JsonObject();
        istCoinContract.addProperty("address", "000000000000000000000000000000000000000a");
        istCoinContract.addProperty("balance", 0);
        istCoinContract.addProperty("code", "0x610160604052348015610010575f80fd5b506040516130f23803806130f283398181016040528101906100329190610774565b80806040518060400160405280600881526020017f49535420436f696e000000000000000000000000000000000000000000000000815250806040518060400160405280600181526020017f31000000000000000000000000000000000000000000000000000000000000008152506040518060400160405280600881526020017f49535420436f696e0000000000000000000000000000000000000000000000008152506040518060400160405280600381526020017f4953540000000000000000000000000000000000000000000000000000000000815250816003908161011c91906109d9565b50806004908161012c91906109d9565b50505061014360058361029860201b90919060201c565b610120818152505061015f60068261029860201b90919060201c565b6101408181525050818051906020012060e08181525050808051906020012061010081815250504660a0818152505061019c6102e560201b60201c565b608081815250503073ffffffffffffffffffffffffffffffffffffffff1660c08173ffffffffffffffffffffffffffffffffffffffff16815250505050505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff160361024a575f6040517f1e4fbdf70000000000000000000000000000000000000000000000000000000081526004016102419190610ab7565b60405180910390fd5b6102598161033f60201b60201c565b50506102928161026d61040260201b60201c565b600a6102799190610c38565b620f42406102879190610c82565b61040a60201b60201c565b50610ed5565b5f6020835110156102b9576102b28361048f60201b60201c565b90506102df565b826102c9836104f460201b60201c565b5f0190816102d791906109d9565b5060ff5f1b90505b92915050565b5f7f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f60e051610100514630604051602001610324959493929190610cea565b60405160208183030381529060405280519060200120905090565b5f60085f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690508160085f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b5f6002905090565b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff160361047a575f6040517fec442f050000000000000000000000000000000000000000000000000000000081526004016104719190610ab7565b60405180910390fd5b61048b5f83836104fd60201b60201c565b5050565b5f80829050601f815111156104db57826040517f305a27a90000000000000000000000000000000000000000000000000000000081526004016104d29190610da1565b60405180910390fd5b8051816104e790610dee565b5f1c175f1b915050919050565b5f819050919050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff160361054d578060025f8282546105419190610e54565b9250508190555061061b565b5f805f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20549050818110156105d6578381836040517fe450d38c0000000000000000000000000000000000000000000000000000000081526004016105cd93929190610e87565b60405180910390fd5b8181035f808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2081905550505b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610662578060025f82825403925050819055506106ac565b805f808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055505b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516107099190610ebc565b60405180910390a3505050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6107438261071a565b9050919050565b61075381610739565b811461075d575f80fd5b50565b5f8151905061076e8161074a565b92915050565b5f6020828403121561078957610788610716565b5b5f61079684828501610760565b91505092915050565b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061081a57607f821691505b60208210810361082d5761082c6107d6565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f6008830261088f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610854565b6108998683610854565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f6108dd6108d86108d3846108b1565b6108ba565b6108b1565b9050919050565b5f819050919050565b6108f6836108c3565b61090a610902826108e4565b848454610860565b825550505050565b5f90565b61091e610912565b6109298184846108ed565b505050565b5b8181101561094c576109415f82610916565b60018101905061092f565b5050565b601f8211156109915761096281610833565b61096b84610845565b8101602085101561097a578190505b61098e61098685610845565b83018261092e565b50505b505050565b5f82821c905092915050565b5f6109b15f1984600802610996565b1980831691505092915050565b5f6109c983836109a2565b9150826002028217905092915050565b6109e28261079f565b67ffffffffffffffff8111156109fb576109fa6107a9565b5b610a058254610803565b610a10828285610950565b5f60209050601f831160018114610a41575f8415610a2f578287015190505b610a3985826109be565b865550610aa0565b601f198416610a4f86610833565b5f5b82811015610a7657848901518255600182019150602085019450602081019050610a51565b86831015610a935784890151610a8f601f8916826109a2565b8355505b6001600288020188555050505b505050505050565b610ab181610739565b82525050565b5f602082019050610aca5f830184610aa8565b92915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f8160011c9050919050565b5f808291508390505b6001851115610b5257808604811115610b2e57610b2d610ad0565b5b6001851615610b3d5780820291505b8081029050610b4b85610afd565b9450610b12565b94509492505050565b5f82610b6a5760019050610c25565b81610b77575f9050610c25565b8160018114610b8d5760028114610b9757610bc6565b6001915050610c25565b60ff841115610ba957610ba8610ad0565b5b8360020a915084821115610bc057610bbf610ad0565b5b50610c25565b5060208310610133831016604e8410600b8410161715610bfb5782820a905083811115610bf657610bf5610ad0565b5b610c25565b610c088484846001610b09565b92509050818404811115610c1f57610c1e610ad0565b5b81810290505b9392505050565b5f60ff82169050919050565b5f610c42826108b1565b9150610c4d83610c2c565b9250610c7a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8484610b5b565b905092915050565b5f610c8c826108b1565b9150610c97836108b1565b9250828202610ca5816108b1565b91508282048414831517610cbc57610cbb610ad0565b5b5092915050565b5f819050919050565b610cd581610cc3565b82525050565b610ce4816108b1565b82525050565b5f60a082019050610cfd5f830188610ccc565b610d0a6020830187610ccc565b610d176040830186610ccc565b610d246060830185610cdb565b610d316080830184610aa8565b9695505050505050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f610d738261079f565b610d7d8185610d3b565b9350610d8d818560208601610d4b565b610d9681610d59565b840191505092915050565b5f6020820190508181035f830152610db98184610d69565b905092915050565b5f81519050919050565b5f819050602082019050919050565b5f610de58251610cc3565b80915050919050565b5f610df882610dc1565b82610e0284610dcb565b9050610e0d81610dda565b92506020821015610e4d57610e487fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff83602003600802610854565b831692505b5050919050565b5f610e5e826108b1565b9150610e69836108b1565b9250828201905080821115610e8157610e80610ad0565b5b92915050565b5f606082019050610e9a5f830186610aa8565b610ea76020830185610cdb565b610eb46040830184610cdb565b949350505050565b5f602082019050610ecf5f830184610cdb565b92915050565b60805160a05160c05160e0516101005161012051610140516121cc610f265f395f610e8001525f610e4501525f61130501525f6112e401525f610bf901525f610c4f01525f610c7801526121cc5ff3fe608060405234801561000f575f80fd5b506004361061012a575f3560e01c80637ecebe00116100ab578063d505accf1161006f578063d505accf14610360578063d5749d421461037c578063dd62ed3e146103ac578063f2fde38b146103dc578063fe575a87146103f85761012a565b80637ecebe00146102a057806384b0196e146102d05780638da5cb5b146102f457806395d89b4114610312578063a9059cbb146103305761012a565b80633644e515116100f25780633644e515146101e8578063417c73a714610206578063537df3b61461023657806370a0823114610266578063715018a6146102965761012a565b806306fdde031461012e578063095ea7b31461014c57806318160ddd1461017c57806323b872dd1461019a578063313ce567146101ca575b5f80fd5b610136610428565b60405161014391906119d4565b60405180910390f35b61016660048036038101906101619190611a85565b6104b8565b6040516101739190611add565b60405180910390f35b6101846104da565b6040516101919190611b05565b60405180910390f35b6101b460048036038101906101af9190611b1e565b6104e3565b6040516101c19190611add565b60405180910390f35b6101d2610541565b6040516101df9190611b89565b60405180910390f35b6101f0610549565b6040516101fd9190611bba565b60405180910390f35b610220600480360381019061021b9190611bd3565b610557565b60405161022d9190611add565b60405180910390f35b610250600480360381019061024b9190611bd3565b610616565b60405161025d9190611add565b60405180910390f35b610280600480360381019061027b9190611bd3565b6106d3565b60405161028d9190611b05565b60405180910390f35b61029e610718565b005b6102ba60048036038101906102b59190611bd3565b61072b565b6040516102c79190611b05565b60405180910390f35b6102d861073c565b6040516102eb9796959493929190611cfe565b60405180910390f35b6102fc6107e1565b6040516103099190611d80565b60405180910390f35b61031a610809565b60405161032791906119d4565b60405180910390f35b61034a60048036038101906103459190611a85565b610899565b6040516103579190611add565b60405180910390f35b61037a60048036038101906103759190611ded565b6108f5565b005b61039660048036038101906103919190611bd3565b610a3a565b6040516103a39190611add565b60405180910390f35b6103c660048036038101906103c19190611e8a565b610a57565b6040516103d39190611b05565b60405180910390f35b6103f660048036038101906103f19190611bd3565b610ad9565b005b610412600480360381019061040d9190611bd3565b610b5d565b60405161041f9190611add565b60405180910390f35b60606003805461043790611ef5565b80601f016020809104026020016040519081016040528092919081815260200182805461046390611ef5565b80156104ae5780601f10610485576101008083540402835291602001916104ae565b820191905f5260205f20905b81548152906001019060200180831161049157829003601f168201915b5050505050905090565b5f806104c2610baf565b90506104cf818585610bb6565b600191505092915050565b5f600254905090565b5f6104ed84610b5d565b1561052d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161052490611f6f565b60405180910390fd5b610538848484610bc8565b90509392505050565b5f6002905090565b5f610552610bf6565b905090565b5f610560610cac565b60095f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff16156105b7575f9050610611565b600160095f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff021916908315150217905550600190505b919050565b5f61061f610cac565b60095f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff16610675575f90506106ce565b5f60095f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff021916908315150217905550600190505b919050565b5f805f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20549050919050565b610720610cac565b6107295f610d33565b565b5f61073582610df6565b9050919050565b5f6060805f805f606061074d610e3c565b610755610e77565b46305f801b5f67ffffffffffffffff81111561077457610773611f8d565b5b6040519080825280602002602001820160405280156107a25781602001602082028036833780820191505090505b507f0f00000000000000000000000000000000000000000000000000000000000000959493929190965096509650965096509650965090919293949596565b5f60085f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b60606004805461081890611ef5565b80601f016020809104026020016040519081016040528092919081815260200182805461084490611ef5565b801561088f5780601f106108665761010080835404028352916020019161088f565b820191905f5260205f20905b81548152906001019060200180831161087257829003601f168201915b5050505050905090565b5f6108a333610b5d565b156108e3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108da90611f6f565b60405180910390fd5b6108ed8383610eb2565b905092915050565b8342111561093a57836040517f627913020000000000000000000000000000000000000000000000000000000081526004016109319190611b05565b60405180910390fd5b5f7f6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c98888886109688c610ed4565b8960405160200161097e96959493929190611fba565b6040516020818303038152906040528051906020012090505f6109a082610f27565b90505f6109af82878787610f40565b90508973ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614610a2357808a6040517f4b800e46000000000000000000000000000000000000000000000000000000008152600401610a1a929190612019565b60405180910390fd5b610a2e8a8a8a610bb6565b50505050505050505050565b6009602052805f5260405f205f915054906101000a900460ff1681565b5f60015f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054905092915050565b610ae1610cac565b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610b51575f6040517f1e4fbdf7000000000000000000000000000000000000000000000000000000008152600401610b489190611d80565b60405180910390fd5b610b5a81610d33565b50565b5f60095f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff169050919050565b5f33905090565b610bc38383836001610f6e565b505050565b5f80610bd2610baf565b9050610bdf85828561113d565b610bea8585856111d0565b60019150509392505050565b5f7f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff16148015610c7157507f000000000000000000000000000000000000000000000000000000000000000046145b15610c9e577f00000000000000000000000000000000000000000000000000000000000000009050610ca9565b610ca66112c0565b90505b90565b610cb4610baf565b73ffffffffffffffffffffffffffffffffffffffff16610cd26107e1565b73ffffffffffffffffffffffffffffffffffffffff1614610d3157610cf5610baf565b6040517f118cdaa7000000000000000000000000000000000000000000000000000000008152600401610d289190611d80565b60405180910390fd5b565b5f60085f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690508160085f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b5f60075f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20549050919050565b6060610e7260057f000000000000000000000000000000000000000000000000000000000000000061135590919063ffffffff16565b905090565b6060610ead60067f000000000000000000000000000000000000000000000000000000000000000061135590919063ffffffff16565b905090565b5f80610ebc610baf565b9050610ec98185856111d0565b600191505092915050565b5f60075f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f815480929190600101919050559050919050565b5f610f39610f33610bf6565b83611402565b9050919050565b5f805f80610f5088888888611442565b925092509250610f608282611529565b829350505050949350505050565b5f73ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1603610fde575f6040517fe602df05000000000000000000000000000000000000000000000000000000008152600401610fd59190611d80565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff160361104e575f6040517f94280d620000000000000000000000000000000000000000000000000000000081526004016110459190611d80565b60405180910390fd5b8160015f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20819055508015611137578273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258460405161112e9190611b05565b60405180910390a35b50505050565b5f6111488484610a57565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8110156111ca57818110156111bb578281836040517ffb8f41b20000000000000000000000000000000000000000000000000000000081526004016111b293929190612040565b60405180910390fd5b6111c984848484035f610f6e565b5b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603611240575f6040517f96c6fd1e0000000000000000000000000000000000000000000000000000000081526004016112379190611d80565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036112b0575f6040517fec442f050000000000000000000000000000000000000000000000000000000081526004016112a79190611d80565b60405180910390fd5b6112bb83838361168b565b505050565b5f7f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f7f00000000000000000000000000000000000000000000000000000000000000007f0000000000000000000000000000000000000000000000000000000000000000463060405160200161133a959493929190612075565b60405160208183030381529060405280519060200120905090565b606060ff5f1b83146113715761136a836118a4565b90506113fc565b81805461137d90611ef5565b80601f01602080910402602001604051908101604052809291908181526020018280546113a990611ef5565b80156113f45780601f106113cb576101008083540402835291602001916113f4565b820191905f5260205f20905b8154815290600101906020018083116113d757829003601f168201915b505050505090505b92915050565b5f6040517f190100000000000000000000000000000000000000000000000000000000000081528360028201528260228201526042812091505092915050565b5f805f7f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0845f1c111561147e575f60038592509250925061151f565b5f6001888888886040515f81526020016040526040516114a194939291906120c6565b6020604051602081039080840390855afa1580156114c1573d5f803e3d5ffd5b5050506020604051035190505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603611512575f60015f801b9350935093505061151f565b805f805f1b935093509350505b9450945094915050565b5f600381111561153c5761153b612109565b5b82600381111561154f5761154e612109565b5b0315611687576001600381111561156957611568612109565b5b82600381111561157c5761157b612109565b5b036115b3576040517ff645eedf00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600260038111156115c7576115c6612109565b5b8260038111156115da576115d9612109565b5b0361161e57805f1c6040517ffce698f70000000000000000000000000000000000000000000000000000000081526004016116159190611b05565b60405180910390fd5b60038081111561163157611630612109565b5b82600381111561164457611643612109565b5b0361168657806040517fd78bce0c00000000000000000000000000000000000000000000000000000000815260040161167d9190611bba565b60405180910390fd5b5b5050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036116db578060025f8282546116cf9190612163565b925050819055506117a9565b5f805f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054905081811015611764578381836040517fe450d38c00000000000000000000000000000000000000000000000000000000815260040161175b93929190612040565b60405180910390fd5b8181035f808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2081905550505b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036117f0578060025f828254039250508190555061183a565b805f808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055505b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516118979190611b05565b60405180910390a3505050565b60605f6118b083611916565b90505f602067ffffffffffffffff8111156118ce576118cd611f8d565b5b6040519080825280601f01601f1916602001820160405280156119005781602001600182028036833780820191505090505b5090508181528360208201528092505050919050565b5f8060ff835f1c169050601f81111561195b576040517fb3512b0c00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b80915050919050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f6119a682611964565b6119b0818561196e565b93506119c081856020860161197e565b6119c98161198c565b840191505092915050565b5f6020820190508181035f8301526119ec818461199c565b905092915050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f611a21826119f8565b9050919050565b611a3181611a17565b8114611a3b575f80fd5b50565b5f81359050611a4c81611a28565b92915050565b5f819050919050565b611a6481611a52565b8114611a6e575f80fd5b50565b5f81359050611a7f81611a5b565b92915050565b5f8060408385031215611a9b57611a9a6119f4565b5b5f611aa885828601611a3e565b9250506020611ab985828601611a71565b9150509250929050565b5f8115159050919050565b611ad781611ac3565b82525050565b5f602082019050611af05f830184611ace565b92915050565b611aff81611a52565b82525050565b5f602082019050611b185f830184611af6565b92915050565b5f805f60608486031215611b3557611b346119f4565b5b5f611b4286828701611a3e565b9350506020611b5386828701611a3e565b9250506040611b6486828701611a71565b9150509250925092565b5f60ff82169050919050565b611b8381611b6e565b82525050565b5f602082019050611b9c5f830184611b7a565b92915050565b5f819050919050565b611bb481611ba2565b82525050565b5f602082019050611bcd5f830184611bab565b92915050565b5f60208284031215611be857611be76119f4565b5b5f611bf584828501611a3e565b91505092915050565b5f7fff0000000000000000000000000000000000000000000000000000000000000082169050919050565b611c3281611bfe565b82525050565b611c4181611a17565b82525050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b611c7981611a52565b82525050565b5f611c8a8383611c70565b60208301905092915050565b5f602082019050919050565b5f611cac82611c47565b611cb68185611c51565b9350611cc183611c61565b805f5b83811015611cf1578151611cd88882611c7f565b9750611ce383611c96565b925050600181019050611cc4565b5085935050505092915050565b5f60e082019050611d115f83018a611c29565b8181036020830152611d23818961199c565b90508181036040830152611d37818861199c565b9050611d466060830187611af6565b611d536080830186611c38565b611d6060a0830185611bab565b81810360c0830152611d728184611ca2565b905098975050505050505050565b5f602082019050611d935f830184611c38565b92915050565b611da281611b6e565b8114611dac575f80fd5b50565b5f81359050611dbd81611d99565b92915050565b611dcc81611ba2565b8114611dd6575f80fd5b50565b5f81359050611de781611dc3565b92915050565b5f805f805f805f60e0888a031215611e0857611e076119f4565b5b5f611e158a828b01611a3e565b9750506020611e268a828b01611a3e565b9650506040611e378a828b01611a71565b9550506060611e488a828b01611a71565b9450506080611e598a828b01611daf565b93505060a0611e6a8a828b01611dd9565b92505060c0611e7b8a828b01611dd9565b91505092959891949750929550565b5f8060408385031215611ea057611e9f6119f4565b5b5f611ead85828601611a3e565b9250506020611ebe85828601611a3e565b9150509250929050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f6002820490506001821680611f0c57607f821691505b602082108103611f1f57611f1e611ec8565b5b50919050565b7f53656e64657220697320626c61636b6c697374656400000000000000000000005f82015250565b5f611f5960158361196e565b9150611f6482611f25565b602082019050919050565b5f6020820190508181035f830152611f8681611f4d565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b5f60c082019050611fcd5f830189611bab565b611fda6020830188611c38565b611fe76040830187611c38565b611ff46060830186611af6565b6120016080830185611af6565b61200e60a0830184611af6565b979650505050505050565b5f60408201905061202c5f830185611c38565b6120396020830184611c38565b9392505050565b5f6060820190506120535f830186611c38565b6120606020830185611af6565b61206d6040830184611af6565b949350505050565b5f60a0820190506120885f830188611bab565b6120956020830187611bab565b6120a26040830186611bab565b6120af6060830185611af6565b6120bc6080830184611c38565b9695505050505050565b5f6080820190506120d95f830187611bab565b6120e66020830186611b7a565b6120f36040830185611bab565b6121006060830184611bab565b95945050505050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602160045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f61216d82611a52565b915061217883611a52565b92508282019050808211156121905761218f612136565b5b9291505056fea26469706673582212202981429701765b63ebc919846c36a2125361393125e67f6a1ca915d6bfb9af4964736f6c634300081a00330000000000000000000000000000000000000000000000000000000000000001");
        istCoinContract.addProperty("transfer", "a9059cbb");
        istCoinContract.addProperty("transferFrom", "23b872dd");
        istCoinContract.addProperty("addToBlackList", "417c73a7");
        istCoinContract.addProperty("removeFromBlackList", "537df3b6");
        istCoinContract.addProperty("isBlackListed", "fe575a87");
        istCoinContract.addProperty("approve", "095ea7b3");
        istCoinContract.addProperty("owner", "0000000000000000000000000000000000000001");
        JsonObject istCoinStorage = new JsonObject();
        istCoinStorage.addProperty("key1", "value1");
        istCoinStorage.addProperty("key2", "value2");
        istCoinContract.add("storage", istCoinStorage);
        state.add("ISTCoin", istCoinContract);

        // Add the state to the genesis block
        genesisBlock.add("state", state);

        // Convert the genesis block to a string
        String genesisBlockString = genesisBlock.toString();

        // Specify the file to write the genesis block to
        File file = new File("src/main/java/com/ist/DepChain/genesis_block/genesis_block.json");

        // Write the genesis block JSON to the file
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(file))) {
            writer.write(genesisBlockString);
            System.out.println("Genesis block written to 'genesis_block.json'");
        } catch (IOException e) {
            System.err.println("Error writing to file: " + e.getMessage());
        }
    }

    private static String generateRSAKeys(String clientName) throws GeneralSecurityException, IOException {
        System.out.println("Generating RSA keys for client " + clientName);
        KeyPairGenerator keyGen = KeyPairGenerator.getInstance("RSA");
        keyGen.initialize(4096);
        KeyPair keys = keyGen.generateKeyPair();

        PrivateKey privKey = keys.getPrivate();
        byte[] privKeyEncoded = privKey.getEncoded();

        try (FileOutputStream privFos = new FileOutputStream("src/main/java/com/ist/DepChain/keys/" + clientName + "_priv.key")) {
            privFos.write(privKeyEncoded);
        }

        PublicKey pubKey = keys.getPublic();
        byte[] pubKeyEncoded = pubKey.getEncoded();

        try (FileOutputStream pubFos = new FileOutputStream("src/main/java/com/ist/DepChain/keys/" + clientName + "_pub.key")) {
            pubFos.write(pubKeyEncoded);
        } 
        return Base64.getEncoder().encodeToString(pubKeyEncoded);     
    }
}
